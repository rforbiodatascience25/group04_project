---
title: "Group04 Presentation R4BDS"
author: "Eric Calaveras - Sol Escamilla - Beatriz García - Lucía López - Diego Medina"
editor: visual
echo: true
format:
  revealjs:
    css: styles.css
    slide-number: true
    background-color: "#CCE6FF"
---

# INTRODUCTION {.slide-title}

------------------------------------------------------------------------

## Introduction {.slide-title2}

<div>

<br>

![](images/Borovecki$x-01.png){fig-align="center"}

</div>

# MATERIALS AND METHODS {.slide-title}

------------------------------------------------------------------------

## Materials and methods {.slide-title2}

### Data Wrangling: From messy to tidy data {.slide-title3}

<br>

::: column
<br>

<br>

```{r eval=FALSE}

borovecki <- borovecki$x |>
  as_tibble() |>
  mutate(
    sample = row_number(), 
    .before = 1, 
    diagnosis = borovecki$y
  )

borovecki <- borovecki |>
  pivot_longer(
    cols = ends_with("at"),
    names_to = "probeID", 
    values_to = "expressionValue",
    values_drop_na = TRUE
  )
```
:::

::: column
![](images/Borovecki_tibble01.png){fig-align="center" width="510"}

![](images/Borovecki_tibble_long00.png){fig-align="center" width="480"}
:::

## Materials and methods {.slide-title2}

### Data Wrangling: From messy to tidy data {.slide-title3}

<br>

---
layout: 2-col
---

::: column
<br>

<br>

```{r eval=FALSE}

borovecki <- borovecki |>
  mutate(
    gene = mapIds(
      hgu133a.db, 
      keys=probeID, 
      keytype = "PROBEID", 
      column="SYMBOL",
      multiVals="first"
    )
  ) |>
  filter(!is.na(gene)) |>
  dplyr::select(-probeID)

borovecki_geneLevel <- borovecki |>
  group_by(sample, gene) |>
  summarise(expression = mean(expression), .groups = "drop")
```
:::

::: column
![](images/Borovecki_mapsid.png){fig-align="center"}

![](images/Borovecki_tibble-02.png){fig-align="center"}
:::

## Materials and methods {.slide-title2}

### Normalization: From raw to standardized data {.slide-title3}

<br>

---
layout: 2-col
---

::: column
```{r eval=FALSE}
raw_histogram <- ggplot(borovecki_data, aes(x = expressionValue,fill = "Raw data")) +
  geom_histogram(bins = 50, alpha = 0.6) +
  fill_scale+
  theme_minimal(base_size = 14) +
  labs(x = "Expression value",
       y = "Count") +
  theme(plot.title = element_text(size = 13, 
                                  hjust = 0.5)) 

log2_histogram <- ggplot(borovecki_data, aes(x = log2_expression,  fill = "Log2 data")) +
  geom_histogram(bins = 100, alpha = 0.6) +
  fill_scale +
  theme_minimal(base_size = 14) +
  labs(x = "log2(Expression value)",
       y = "Count") +
  theme(plot.title = element_text(size = 13,
                                  hjust = 0.5))
raw_histogram + log2_histogram + 
  plot_layout(guides = "collect")+
  plot_annotation(title="Comparison between Raw and Log2-Transformed Expression Data", 
                  caption="Data from: Borovecki et al. 2005") &
  theme(legend.position = "right")
```
:::

::: column
![](images/comparison1_raw_log2-04.png){fig-align="center"}
:::

## Materials and methods {.slide-title2}

### Linear Modeling {.slide-title3}

<br>

---
layout: 2-col
---

::: column
```{r eval=FALSE}
borovecki_tibble <- borovecki_tibble |>
  pivot_wider(
    # Columns not to pivot
    id_cols = c(sample, diagnosis),
    # Columns to pivot
    names_from = gene,
    values_from = expressionValue
  ) |>
  mutate(
    Diagnosis = case_when(
      diagnosis == "symptomatic" ~ 1,
      diagnosis == "control" ~ 0
    )
  ) |>
  dplyr::select(-c(diagnosis,sample)) |>
  relocate(Diagnosis, .before = 1)

borovecki_tibble_long <- borovecki_tibble  |> 
  pivot_longer(
    cols = -Diagnosis,
    names_to = "gene",
    values_to = "log2_expr_level"
  ) |>
  mutate(
    log2_expr_level = log2(log2_expr_level) 
  )
borovecki_tibble_long_nested <- borovecki_tibble_long |> 
  group_by(gene) |> 
  nest() |> 
  ungroup()
```
:::

::: column
![](images/Borovecki_tibble.png){fig-align="center" width="500"}

![](images/borovecki__tibble_long.png){fig-align="center" width="400"}

![](images/borovecki_tibble_long_nested_prelm.png){fig-align="center" width="350"}
:::

## Materials and methods {.slide-title2}

### Linear Modeling {.slide-title3}

<div>

<br>

---
layout: 2-col
---

::: column
```{r eval=FALSE}
by_gene <- borovecki_tibble_long_nested |> 
  group_by(gene)
linear_model <- function(df) {
  lm(
  log2_expr_level ~ Diagnosis , 
  data = df)
}
borovecki_tibble_long_nested  <- borovecki_tibble_long_nested  |>  
  mutate(model_object = map(data, linear_model))
tidy_data <- function(df) {
  df |>
  tidy(conf.int = TRUE,
       conf.level = 0.95)
  }
borovecki_estimates <- borovecki_tibble_long_nested |>
  mutate(model_object_tidy = map(model_object, tidy_data)) |>
  unnest(model_object_tidy) |>
  filter(term == "Diagnosis") |>
  dplyr::select(gene, p.value, estimate, conf.low, conf.high) |> 
  mutate(q.value=p.adjust(p.value),
          is_significant = case_when(
            q.value >= 0.05 ~ "no",
            q.value < 0.05 ~ "yes"
            )
```
:::

::: column
![](images/borovecki_tibble_long_nested.png){fig-align="right"}

![](images/Borovecki_estimates.png){fig-align="center"}
:::

</div>

# RESULTS {.slide-title}

------------------------------------------------------------------------

## Results {.slide-title2}

### Dataset exploration in established genetic modifiers {.slide-title3}

<div>

![](images/Expression_of_DNA_repair_genes_vs_clinical_outcome-03.png){fig-align="center"}

</div>

## Results {.slide-title2}

### Forest Plot {.slide-title3}

<div>

![](images/forest-02.png){fig-align="center" width="2000"} Results

</div>

## Results {.slide-title2}

### Volcano Plot {.slide-title3}

<div>

![](images/volcano-03.png){fig-align="center" width="1200"}

</div>

# DISCUSSION {.slide-title}

------------------------------------------------------------------------

## Discussion {.slide-title2}

<div>

---
layout: 2-col
---

<br>

::: column
**Bioinformatics** is an **essential** tool in modern biological research.

<br>

[Data wrangling]{.underline}

:   Chaos -\> Biologically interpretable structure

[Statistical analysis + Data visualisation]{.underline}

:   Reveal key signals

<br>

**Collaboration** between scientists and bioinformaticians allows for a better understanding of how **diseases** work
:::

::: column
![](images/Flowchart.png){fig-align="center" width="1178"}
:::

</div>

## Thank you {.slide-title2}

<div>

![](images/R_Halloween-02.png){fig-align="center"}

</div>
